Deploiement dans Lightsil AWS ********************

git clone https://github.com/gilles-1/site_folio.git

Ajouter un utilisateur gilles  *********************

adduser gilles

Ajourer un utilisateur gilles au groue sudo ****************

gpasswd -a gilles sudo

Installation de python *******************

sudo apt-get update
sudo apt-get install python3-pip python3-dev libpq-dev

Environnement virtuel et dépendances ****************

sudo apt install virtualenv
 virtualenv env -p python3
 source env/bin/activate
 
pip install -r requirements.txt

Génération des fichiers statiques *********************

mkdir -p /home/ubuntu/site_folio/merchex/merchex/static
export ENV=PRODUCTION
python manage.py collectstatic

Attribution des doits au dossier parent du dossier du site et a tous ses sous dossier *****************

sudo chmod 755 /home/ubuntu/
sudo chown -R www-data:www-data /home/ubuntu/

sudo chmod 777 /home/ubuntu/site_folio/merchex/db.sqlite3                 Mettre les droits d'ecritures sur le fichier de la bd
sudo chmod 777 /home/ubuntu/site_folio/merchex/


Installation et configuration de nginx ************************

sudo apt-get install nginx

cd /etc/nginx

sudo touch sites-available/site_folio
sudo ln -s /etc/nginx/sites-available/site_folio /etc/nginx/sites-enabled

sudo tail -f /var/log/nginx/error.log

cd /etc/nginx

sudo nano sites-available/site_folio

server {
    # ...
	
	listen 80; server_name 3.99.177.244; 
    root /home/ubuntu/site_folio/;

    location /static {
        alias /home/ubuntu/site_folio/merchex/merchex/staticfiles;
    }

    location / {
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
        if (!-f $request_filename) {
            proxy_pass http://127.0.0.1:8000;
            break;
        }
    }
}

sudo service nginx reload

Installation est configuration de gunicorn

gunicorn merchex.wsgi:application

sudo lsof -i :8000                         sudo kill -9 PID             sudo tail -f /var/log/nginx/error.log


Configuration de git *********************


Supervisor est un système qui permet de contrôler un ensemble de processus vivant dans un environnement UNIX. Pour faire simple, 
Supervisor lance des services et les redémarre s'ils échouent

sudo apt-get install supervisor
sudo nano /etc/supervisor/conf.d/site_folio-gunicorn.conf

Ajouter a l'interieur du fichier la commande : 

command=/home/ubuntu/site_folio/env/bin/gunicorn merchex.wsgi:application
directory = /home/ubuntu/site_folio
autostart = true
autorestart = true

$ sudo supervisorctl reread
disquaire-gunicorn: available
$ sudo supervisorctl update
disquaire-gunicorn: added process group

$ sudo supervisorctl status
disquaire-gunicorn               RUNNING   pid 16309, uptime 0:00:09


Deploiement de la partie Frontend Vue.js

sudo apt install nodejs npm

sudo chown -R www-data:www-data /home/ubuntu/site_folio/merchex/front
chmod -R 777 /home/ubuntu/site_folio/merchex/front

sudo find /home/ubuntu/site_folio/merchex/front -type d -exec chmod 755 {} \;
sudo find /home/ubuntu/site_folio/merchex/front -type f -exec chmod 644 {} \;

sudo npm install

sudo touch /etc/nginx/sites-available/front
sudo ln -s /etc/nginx/sites-available/front /etc/nginx/sites-enabled/front
sudo nano /etc/nginx/sites-available/front

FICHIER A COLLER

server {

listen80;

server_name 3.99.177.244;

charset utf-8;

root    /home/ubuntu/site_folio/merchex/front/dist;

index   index.html index.htm;

    # Always serve index.html for any request

location / {

root /home/ubuntu/site_folio/merchex/front/dist;

try_files $uri /index.html;

}

error_log  /var/log/nginx/vue-app-error.log;

access_log /var/log/nginx/vue-app-access.log;

}

FICHIER A COLLER

sudo nginx -t
sudo service nginx restart

Acceder a 3.99.177.244

sudo tail -n 50 /var/log/nginx/error.log
sudo service nginx reload

ls -l /home/ubuntu/site_folio/merchex/front/public/favicon.ico

sudo npm install -g @vue/cli

sudo chown -R 1000:1000 "/home/ubuntu/.npm"

npm install @vue/cli --verbose

reussi   *********
sudo mkdir -p ~/.npm
sudo chown -R ubuntu:sudo ~/.npm
npm install @vue/cli --verbose
sudo snap install vue
vue --version
sudo mkdir -p ~/snap
sudo chown -R ubuntu:sudo ~/snap
sudo npm run build

sudo chmod -R 755 /home/ubuntu/site_folio/merchex/front/node_modules
sudo npm install
reussi   **********

